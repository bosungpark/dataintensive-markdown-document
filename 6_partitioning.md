파티셔닝
=
데이터셋이 매우 크거나 질의 처리량이 매우 높다면 복제만으로는 부족하고 데이터를 파티션으로 쪼갤 필요가 있다. 이 작업을 파티셔닝 또는 샤딩이라고 한다.

결과적으로 각 파티션은 그 자체로 작은 데이터베이스가 된다. 즉 테이블은 논리적인 하나의 테이블이지만 물리적으로는 여러 개의 테이블로 분리해서 관리할 수 있게 해주는 기능이다.

- 확장성
- 이력 데이터의 효율적인 관리

보통 복제와 파티셔닝을 함께 적용해 각 파티션의 복사본을 여러 노드에 저장한다. 
한 노드에 여러 파티션을 저장할 수도 있다. 리더 팔로워 복제 모델을 사용한다면 각 파티션의 리더는 하나의 노드에 할당되고 팔로워들은 다른 노드에 할당된다. 각 노드는 어떤 파티션에게는 리더이면서 다른 파티션에게는 팔로워가 될 수 있다.

키-값 데이터 파티셔닝
=
skewed(쏠림): 파티셔닝이 고르게 이뤄지지 않아 다른 파티션보다 데이터가 많거나 질의를 많이 받는 파티션이 있는 경우

hotspot(핫스팟) : 불균형하게 부하가 높은 파티션을 지칭하는 용어

키 범위 기준 파티셔닝 
=
각 파티션에 연속된 범위의 키를 할당하는 것이다. 이를 통해 각 범위들 사이의 경계를 알 수 있고 어떤 키가 어떤 파티션에 속하는지 쉽게 찾을 수 있다. 또한, 어떤 파티션이 어느 노드에 할당됐는지 알면 적절한 노드로 요청을 직접 보낼 수 있다.

장점: 인덱스와 비슷한 효과를 낼 수 있다.
단점: 특정한 접근 패턴이 핫스팟을 유발한다.

키의 해시값 기준 파티셔닝 
=
해시 파티션은 특정 해시 함수에 의해 레코드가 저장될 파티션을 결정하는 방법이다. 

잠점: 쏠림과 핫스팟의 위험을 줄여 쏠린 데이터를 입력으로 받아 균일하게 분산되게 한다.
단점: 범위 질의를 효율적으로 실행할 수 있는 키 범위 파티셔닝의 좋은 속성을 잃어버린다. 전에는 인접했던 키들이 이제는 모든 파티션에 흩어져서 정렬 순서가 유지되지 않는다.

파티셔닝과 보조 색인 
=
파티션으로 읽기 쓰기 요청을 전달할 때, 특정한 값이 발생한 항목을 검색하는 수단인 보조색인이 연관되면 복잡해 진다.

각 파티션에 속하는 문서만 담당하며 완전히 독립적으로 동작하는 색인 방법을 지역 색인(Local Index)이라고 한다.

데이터베이스에 문서 추가, 삭제, 갱신 등의 쓰기 작업을 실행할 때는 쓰려고 하는 문서 ID를 포함하는 파티션만 다루면 된다. 다른 파티션에 어떤 데이터가 저장되는지 신경 쓰지 않는다.

여러 파티션에서 질의를 병렬 실행 하더라도 스캐터/개더는 꼬리 지연 시간 증폭이 발생하기 쉽다. 그럼에도 보조 색인을 문서 기준으로 파티셔닝하는 경우가 많다.

용어 기준 보조 색인 파티셔닝
=
지역 색인과 다르게 모든 파티션의 데이터를 담당하는 색인을 전역 색인(Global Index)이라고 한다.
이러한 방법은 한 노드에만 색인을 저장할 경우 해당 노드가 병목이 되어 파티셔닝의 목적을 헤칠 수 있기 때문에 여러 노드에 나눠서 저장한다.

- 문서 파티셔닝 색인에 비해 전역(용어 파티셔닝) 색인이 갖는 이점은 읽기가 효율적이라는 것이다.
- 클라이언트는 모든 파티션에 스개터/개더를 실행할 필요 없이 원하는 용어를 포함하는 파티션으로만 요청을 보내면 된다.
- 단일 문서를 쓸 때 해당 색인의 여러 파티션에 영향을 줄 수 있으며 쓰기가 느리고 복잡하다.

용어 파티셔닝 색인을 사용할 때 그렇게 하려면 쓰기에 영향받는 모든 파티션에 걸친 분산 트랜잭션을 실행해야 하는데, 모든 데이터베이스에서 분산 트랜잭션을 지원하지는 않는다.

현실에서는 전역 보조 색인은 대개 비동기로 갱신된다.(즉 쓰기를 실행한 후 바로 색인을 읽으면 변경 사항이 색인에 반영되지 않았을 수도 있다.)


재균형화(rebalancing)
=

클러스터에서 한 노드가 담당하던 부하를 다른 노드로 옮기는 과정

- 부하 균등
- 순단 X
- 데이터 이동 최소화


